"use strict";(self.webpackChunkhandbook=self.webpackChunkhandbook||[]).push([[924],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>c});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),h=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=h(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=h(a),c=o,u=m["".concat(l,".").concat(c)]||m[c]||d[c]||i;return a?n.createElement(u,r(r({ref:t},p),{},{components:a})):n.createElement(u,r({ref:t},p))}));function c(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var h=2;h<i;h++)r[h]=a[h];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4165:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>y,frontMatter:()=>p,metadata:()=>m,toc:()=>u});var n=a(7462),o=a(7294),i=a(3905);const r="image-frame_fg61",s="image-frame-inner_Xabn",l="image-frame-title_UNlE";function h(e){let{title:t,url:a}=e;return a?o.createElement("div",{className:r},o.createElement("div",{className:s},o.createElement("img",{alt:t,title:t,src:a})),t&&o.createElement("div",{className:l},t)):null}const p={title:"Entries"},d=void 0,m={unversionedId:"learn/entries",id:"learn/entries",title:"Entries",description:"Trust is funny",source:"@site/docs/learn/entries.md",sourceDirName:"learn",slug:"/learn/entries",permalink:"/handbook/learn/entries",draft:!1,tags:[],version:"current",frontMatter:{title:"Entries"},sidebar:"learn",previous:{title:"Overview",permalink:"/handbook/learn/"}},c={},u=[{value:"Trust is funny",id:"trust-is-funny",level:2},{value:"Bamboo",id:"bamboo",level:2},{value:"Does the Entry really point at this particular Payload?",id:"does-the-entry-really-point-at-this-particular-payload",level:3},{value:"What if the Entry got changed?",id:"what-if-the-entry-got-changed",level:3},{value:"How do we know the Signature really belongs to the Author?",id:"how-do-we-know-the-signature-really-belongs-to-the-author",level:3},{value:"Time",id:"time",level:2},{value:"Logs",id:"logs",level:2},{value:"Deletion",id:"deletion",level:2},{value:"Forks",id:"forks",level:2},{value:"Tags",id:"tags",level:2},{value:"Encoding",id:"encoding",level:2},{value:"Next up",id:"next-up",level:2}],g={toc:u};function y(e){let{components:t,...o}=e;return(0,i.kt)("wrapper",(0,n.Z)({},g,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"trust-is-funny"},"Trust is funny"),(0,i.kt)("p",null,"Oh, we\u2019ve just got this postcard from a Penguin:"),(0,i.kt)(h,{title:"A postcard from Mr. Penguin",url:a(890).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"The Penguin-Postcard-Protocol (PPP) of Shirokuma-Town is a p2p protocol without computers: Every Penguin can send any postcard to any other Penguin through some delivery service which has multiple stations across the town."),(0,i.kt)("p",null,"The Penguins in Shirokuma-Town are very happy with PPP, even though it has many flaws. For example: When we know Mr. Penguin, we probably will follow the invitation, but how can we be ",(0,i.kt)("em",{parentName:"p"},"really")," sure this postcard was actually sent by Mr. Penguin? And how can we be sure that nobody changed that postcard before it arrived in our inbox? Maybe someone from the delivery service changed its message or even the address?"),(0,i.kt)("p",null,"Probably we will not send anything important in a postcard because we can not ",(0,i.kt)("em",{parentName:"p"},"really trust")," the Penguin-Postcard-Protocol. Maybe Mr. Penguin will use Zoognal to send a more important message next time?"),(0,i.kt)("p",null,"On the internet we usually trust some sort of platform or the underlying protocol and hope it will",(0,i.kt)("em",{parentName:"p"}," secure")," our messages. This assures us that the data comes from that person and it didn\u2019t get changed by someone else after it got sent. Most of the time we speak about ",(0,i.kt)("strong",{parentName:"p"},"Authentication")," in this regard: Who is the ",(0,i.kt)("em",{parentName:"p"},"authentic")," person behind that data?"),(0,i.kt)("p",null,"We learned some Authentication patterns from the last years and rely on them a lot: For example we confirm our email addresses or mobile phone numbers and have some kind of password to get access to our accounts."),(0,i.kt)("admonition",{title:"Icebears philosophical corner",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Is that secure? Do email addresses prove enough who we are? We ",(0,i.kt)("em",{parentName:"p"},"do")," put a lot of trust in the computers, programs and platforms we\u2019re using. But that\u2019s also true for everything else around us! This discussion can get very deep and philosophical and not even the most radical \u201ctrust less\u201d p2p protocol can give us a definite answer."),(0,i.kt)("p",{parentName:"admonition"},"We can already see that trust is a funny thing. But enough for now, let\u2019s think about ",(0,i.kt)("em",{parentName:"p"},"some")," solutions we can give to provide authentication in a decentralised system and we will see that they are at least more secure than postcards!")),(0,i.kt)("h2",{id:"bamboo"},"Bamboo"),(0,i.kt)("p",null,"To secure and authenticate ",(0,i.kt)("em",{parentName:"p"},"any")," data, we\u2019re using a special data type named ",(0,i.kt)("strong",{parentName:"p"},"Bamboo")," which helps us with these problems."),(0,i.kt)("admonition",{title:"Infotainment intermission",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The name is no coincidence! Pandas love bamboo! The Bamboo data type was designed (also) with p2panda in mind. Read about it\u2019s specification ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AljoschaMeyer/bamboo"},"here"),".")),(0,i.kt)("p",null,"The main data type of Bamboo is an ",(0,i.kt)("strong",{parentName:"p"},"Entry")," which can point at any sort of data, for example the postcard of Mr. Penguin. We can think about it as a ",(0,i.kt)("em",{parentName:"p"},"seal")," we put on the postcard to indicate that it a) came from a certain person b) it wasn\u2019t opened and potentially changed before it arrived in our inbox."),(0,i.kt)(h,{title:"Entry 'sealing' any data",url:a(7373).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"Let\u2019s look a little bit closer into how Bamboo Entries help us here. From now on we will call any data the ",(0,i.kt)("strong",{parentName:"p"},"Payload"),", just to slowly move towards the terminology used in the official Bamboo specification."),(0,i.kt)("admonition",{title:"Privacy vs. security",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"What about ",(0,i.kt)("em",{parentName:"p"},"privacy"),"? Anyone can read our postcards when we send them around! Bamboo Entries do provide authentication and security, but not  privacy. For this p2panda has something else: Secret Groups!")),(0,i.kt)("h3",{id:"does-the-entry-really-point-at-this-particular-payload"},"Does the Entry really point at this particular Payload?"),(0,i.kt)("p",null,"Whenever we create a new Entry we generate a ",(0,i.kt)("strong",{parentName:"p"},"Hash")," of the data it is pointing at. This Hash we store inside the Entry as the ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash"),". Whenever we receive the Entry and the Payload we re-create the Hash of it ",(0,i.kt)("em",{parentName:"p"},"again")," and compare it with the ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash")," which is given by the original Entry. If they diverge we can be sure the data got changed by someone and we can\u2019t trust it anymore!"),(0,i.kt)("admonition",{title:"What is hashing?",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Hashing is a way to convert (large) data into a shorter representation. For example the letter of Penguin can be expressed as this (BLAKE3) hash: ",(0,i.kt)("inlineCode",{parentName:"p"},"6c35954716cb993c153e55b25650d87119ceacd0646d2de5450b14dd97897b82"),". This allows us to refer to it without sending the whole original data again. We can not re-create the original data from a Hash, this information will be gone, but we will always be able to recreate it and arrive at the same Hash value as soon as we have the original data.")),(0,i.kt)(h,{title:"Comparing hash and size",url:a(1550).Z,mdxType:"ImageFrame"}),(0,i.kt)("admonition",{title:"Hash specification",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"We need to specify ",(0,i.kt)("em",{parentName:"p"},"how")," we hash something so we can recreate and validate hashes at any point. p2panda uses the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/BLAKE3-team/BLAKE3"},"BLAKE3")," hashing algorithm and wraps it around the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AljoschaMeyer/yamf-hash"},"YASMF")," format to allow future changes where we might want to change the hashing algorithm without breaking anything from before.")),(0,i.kt)("p",null,"Next to the ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash")," an Entry also holds the size of the Payload in a field called ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_size"),". If the Payload would be ",(0,i.kt)("inlineCode",{parentName:"p"},"21")," bytes large it would be mentioned there. With this we can check now if a) the Payload size is still the same b) know how large the data is even before we looked at it ourselves."),(0,i.kt)("h3",{id:"what-if-the-entry-got-changed"},"What if the Entry got changed?"),(0,i.kt)("p",null,"We can verify now if the Payload itself got changed by comparing the ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_size")," - but what if the Entry itself got manipulated? To solve this, every Entry contains a ",(0,i.kt)("strong",{parentName:"p"},"Signature"),"! It needs to be generated after the Entry values got set."),(0,i.kt)(h,{title:"Signing an entry with a private key",url:a(7687).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"To sign an Entry we need some sort of ",(0,i.kt)("strong",{parentName:"p"},"Digital Signature Algorithm")," which always comes with a ",(0,i.kt)("strong",{parentName:"p"},"Public-")," and ",(0,i.kt)("strong",{parentName:"p"},"Private Key"),"."),(0,i.kt)("admonition",{title:"Down the cryptography rabbit hole",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Where do we get these keys from? We can simply generate them ourselves without any central authority!"),(0,i.kt)("p",{parentName:"admonition"},"To make sure we can create a key pair without anyone else accidentially creating the same we use cryptographically secure pseudorandom number generators (CSPRNG). These generators are usually given by every computer and help us with finding a very large, random number which very likely will not occur a second time in the world ever."),(0,i.kt)("p",{parentName:"admonition"},"A Digital Signature Algorithm defines how these random numbers are used to derive a Private Key and then a Public Key from it.")),(0,i.kt)("p",null,"The private part is a secret information only the author of this Entry knows about. With the Signature Algorithm we take the Entry and the Private Key as inputs and generate the Signature itself. Finally we store it in the ",(0,i.kt)("inlineCode",{parentName:"p"},"signature")," field of the Entry."),(0,i.kt)("admonition",{title:"Anologies never work",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"An (somewhat) analogy to public key cryptography would be IRL signatures we write with a pen on paper: A person signs a document to show that they \u201capproved\u201d this version of it - but also to authenticate themselves. Ideally only the person knows how to write that signature and nobody else will be able to fake it. This is where the analogy falls a little bit apart: In public key cryptography faking the private key is much harder or almost impossible.")),(0,i.kt)("p",null,"Now we get two guarantees: a) if the Entry data got changed after signing it, the Signature is not valid anymore b) with signing the data we also shown now that we are the owner of that Private Key! A Signature Algorithm assures us that nobody else could have generated that particular signature without knowing the Private Key secret."),(0,i.kt)("admonition",{title:"DSA specification",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Similar to defining the Hashing Algorithm in Bamboo, we also need to define the Digital Signature Algorithm (DSA). p2panda uses ",(0,i.kt)("a",{parentName:"p",href:"https://ed25519.cr.yp.to/"},"Ed25519"),".")),(0,i.kt)("p",null,"Whenever we receive an Entry and Payload now from somewhere, we can check if the Signature really fits the given Entry. If we can not verify the Signature we can\u2019t trust that the Entry didn\u2019t get changed."),(0,i.kt)("h3",{id:"how-do-we-know-the-signature-really-belongs-to-the-author"},"How do we know the Signature really belongs to the Author?"),(0,i.kt)("p",null,"We can verify now if the Payload and Entry didn\u2019t get changed and really belong together, but how do we know that the Signature belongs to that Author?"),(0,i.kt)("p",null,"Besides the ",(0,i.kt)("inlineCode",{parentName:"p"},"signature")," the Entry has needs to provide an ",(0,i.kt)("inlineCode",{parentName:"p"},"author")," field which contains the ",(0,i.kt)("em",{parentName:"p"},"Public Key")," part of the original author. In contrast to the Private Key the public part is not a secret and can be shared with others."),(0,i.kt)("p",null,"When we verify the Signature of the Entry we take the Public Key, the part of the Entry which was used during signing and the Signature itself to check if they all belong together."),(0,i.kt)(h,{title:"Verifying the Signature of an Entry",url:a(255).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"We now have everything to securely authenticate an Entry and it\u2019s Payload. As we can see, this is already better than the Penguin-Postcard-Protocol!"),(0,i.kt)("p",null,"With all of this together the Entry contains: ",(0,i.kt)("inlineCode",{parentName:"p"},"author"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"signature"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_size")," - and there is even more coming!"),(0,i.kt)("h2",{id:"time"},"Time"),(0,i.kt)("p",null,"Mr. Penguin\u2019s postcard has a date printed on it: The delivery service of the postcards stamps it on every card as soon as they receive it."),(0,i.kt)("p",null,"But again, can we trust the delivery service to not just stamp an arbitrary date on the card? Was it really the ",(0,i.kt)("inlineCode",{parentName:"p"},"10.08.2022")," this postcard was seen first?"),(0,i.kt)("admonition",{title:"Icebears philosophical beard",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Time on computers is funny (or time in general). How does the computer know what time it is? Usually it got told at one point where it should start counting and from that point on some small quartz crystal is just ticking the time further, hopefully not getting too much out of sync with the clocks of other devices. The computer even has a small battery for that quartz crystal so it can keep on ticking when it is turned off. Computers with internet usually sync themselves regularly to some sort of central time service, to prevent the delay getting too horrible."),(0,i.kt)("p",{parentName:"admonition"},"When it gets really important we ",(0,i.kt)("em",{parentName:"p"},"want")," to know the date of something, for example when signing a contract digitally! There is a a lot of research in ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Trusted_timestamping"},"Secure Time-stamping")," which addresses this problem with computers."),(0,i.kt)("p",{parentName:"admonition"},"Interestingly the Bamboo specification was inspired by a thesis on Secure Time-stamping, read it ",(0,i.kt)("a",{parentName:"p",href:"https://www.researchgate.net/publication/216824681_Secure_and_Efficient_Time-Stamping_Systems"},"here"),".")),(0,i.kt)("p",null,"We could add a field to Entry to provide a date, similar to the postcard, but first of all, the computer might not even know the right time and even worse, do we trust the claimed date on an Entry from someone else?"),(0,i.kt)("admonition",{title:"Computers are still governed by social constructs",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"It is also okay to use timestamps in p2p protocols if we really want them. Sometimes we might just want to use computers together with our friends or we don\u2019t care if someone lied to us. Bamboo and p2panda does not provide that functionality but it would be easy to add on top.")),(0,i.kt)("p",null,"Bamboo Entries can not solve the problem of ",(0,i.kt)("em",{parentName:"p"},"absolute")," time for us as it is simply ",(0,i.kt)("em",{parentName:"p"},"not possible")," to do this in a decentralised system, but we can introduce something like a ",(0,i.kt)("em",{parentName:"p"},"relative")," time, we can at least proof that an Entry got created ",(0,i.kt)("em",{parentName:"p"},"after")," another."),(0,i.kt)("p",null,"When a new Entry gets created we can point at the previous Entry by calculating the Hash of it and mentioning it in the new Entry. This ",(0,i.kt)("strong",{parentName:"p"},"Backlink Hash")," is stored as the ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink"),". Through this we form some sort of ",(0,i.kt)("em",{parentName:"p"},"linked list")," or ",(0,i.kt)("em",{parentName:"p"},"chain")," of entries. The first Entry does not contain a ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink"),"."),(0,i.kt)(h,{title:"Entries chained by backlinks",url:a(3436).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"Since we are not able to generate hashes without knowing the original data, we can proof that we\u2019ve seen the previous Entry when we created the new one."),(0,i.kt)("admonition",{title:"A hash is a hash is a hash",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Again, similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash"),", that ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink")," was generated with BLAKE3 using the YASMF container format.")),(0,i.kt)("p",null,"As soon as we receive an Entry we can recalculate the hashes and verify that the ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink")," is actually correct. If we receive many entries we have to do this for all of them by ",(0,i.kt)("em",{parentName:"p"},"walking")," the Backlink path from last to first Entry. With this we can proof the ",(0,i.kt)("em",{parentName:"p"},"causal order")," or ",(0,i.kt)("em",{parentName:"p"},"relative time")," of the entries and that they all belong together."),(0,i.kt)("h2",{id:"logs"},"Logs"),(0,i.kt)("p",null,"With Backlinks we come really close to the true nature of Bamboo: It is an ",(0,i.kt)("strong",{parentName:"p"},"Append-Only Log"),"! The chained list of entries is also called a ",(0,i.kt)("strong",{parentName:"p"},"Log")," in Bamboo, while the append-only nature stems from the fact that we\u2019re inserting always new entries at the end of it."),(0,i.kt)("admonition",{title:"\ud83c\udf8d",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Like logs of bamboo plants growing out of the ground.  \ud83c\udf8d \ud83c\udf8d \ud83c\udf8d")),(0,i.kt)("p",null,"Bamboo allows us to create multiple logs per Author, we just need to give it a unique ",(0,i.kt)("strong",{parentName:"p"},"Log Id")," which is a number starting at ",(0,i.kt)("inlineCode",{parentName:"p"},"0"),". Through this we can identify which Entries belongs to which Log as they keep it as the ",(0,i.kt)("inlineCode",{parentName:"p"},"log_id"),". Together with the Backlinks we can make sure that they also really stay inside the claimed Log."),(0,i.kt)(h,{title:"Multiple logs",url:a(4244).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"To check that everything fits together we verify for each incoming Entry that the ",(0,i.kt)("inlineCode",{parentName:"p"},"author")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"log_id")," is the same across the whole Log. Every Log can only be maintained by one single Author. This is also the reason why we call Bamboo a ",(0,i.kt)("em",{parentName:"p"},"Single Writer")," Append-Only Log."),(0,i.kt)("admonition",{title:"Single Writer vs. Multi Writer",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Now you might think that p2panda can only be used by one Person, but this is not the case! p2panda supports collaborative ",(0,i.kt)("em",{parentName:"p"},"Multi-Writer")," settings across Authors and Logs but this is handled outside of Bamboo. Read the ",(0,i.kt)("a",{parentName:"p",href:"/learn/operations"},"Operations")," section to find out more.")),(0,i.kt)("p",null,"Why do we want to have multiple Logs? It can have different reasons, depending on the protocol we want to design. For example we could have a dedicated Log for postcards from Ms. Penko and another one for boring postcards from the tax authority. Whenever the time comes, we can eventually even delete whole logs without removing all the other, unrelated entries. If we would mix up different sorts of messages within the same log it would be harder to delete it."),(0,i.kt)("h2",{id:"deletion"},"Deletion"),(0,i.kt)("p",null,"With the ever-growing nature of Append-Only Logs we might end up with extremely long lists of Entries which comes with two problems: a) we want to safe some space on our hard-disk b) we don\u2019t want to always look at ",(0,i.kt)("em",{parentName:"p"},"all")," Backlinks just to verify the integrity of ",(0,i.kt)("em",{parentName:"p"},"all")," Entries. This takes too much time!"),(0,i.kt)("p",null,"With Backlinks this is tricky, as removing Entries would mean that we tamper with the integrity of the hashes. Holes in a log can easily be detected and will break the chain, we would need to consider such Bamboo data invalid."),(0,i.kt)(h,{title:"Trying to delete an Entry",url:a(2e3).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"We could try to just remove the beginning of a Log instead, this will only break the Backlink for the first Entry which we could say is fine, but how can we now tell that someone didn\u2019t hide some information from us by not sending the whole Log? Before we could at least detect the Entry without a ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink")," to find out if we reached the beginning of the Log. If we would remove that information, we\u2019re lost. In this case we would also need to consider such data invalid."),(0,i.kt)(h,{title:"Trying to delete beginning of a Log",url:a(2046).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"Bamboo solves this problem with a second kind of Hash which is called a ",(0,i.kt)("strong",{parentName:"p"},"Skiplink"),". It allows us to verify the full integrity of the Log even after we\u2019ve deleted some Entries of it."),(0,i.kt)("p",null,"Skiplinks are formed slightly different than Backlinks: Instead of",(0,i.kt)("em",{parentName:"p"}," always")," pointing at the previous Entry they ",(0,i.kt)("em",{parentName:"p"},"sometimes")," point at Entries which are more far away in the past. Based on these rules not every Entry needs to contain a Skiplink: For example in a Log with 8 Entries inside only the 4th and 8th Entry would contain a Skiplink."),(0,i.kt)("p",null,"Skiplinks form an alternative path through the log which is much faster to follow than if we would go through all Backlinks. Also it allows us to delete all Entries which are not on that path."),(0,i.kt)("admonition",{title:"Example",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"This means that we can not delete ",(0,i.kt)("em",{parentName:"p"},"everything")," if we still want to proof the integrity of the data. We need to keep at least the Entries on the Skiplink path. For example: If we have 8 Entries in a Log, we would need to keep at least 2 of them. If we have 40 Entries we only need 4 and so on. The number of required Entries grows only logarithmic.")),(0,i.kt)(h,{title:"Log with Skiplinks and deleted Entries",url:a(2583).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"Another feature of Bamboo is that we can not only delete the Entries but also every Payload, as this data is separated from the Log. This is why we can call Payloads also ",(0,i.kt)("em",{parentName:"p"},"Off-Chain Data"),": Maybe our Log contains Entries pointing at many large images we want to delete after a while. It would be possible to delete these images, free up some space - while the Log integrity stays intact."),(0,i.kt)("admonition",{title:"Math magic",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Read about the math behind Skiplinks in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AljoschaMeyer/bamboo#links-and-entry-verification"},"Bamboo specification")," if you are interested in how it works."),(0,i.kt)("p",{parentName:"admonition"},"If you\u2019re interested in the deeper theory of Binary Linking Schemes, you can also read this great ",(0,i.kt)("a",{parentName:"p",href:"https://aljoscha-meyer.de/linkingschemes"},"summary"),".")),(0,i.kt)("p",null,"Removing Entries or Payloads is not only interesting for freeing up space on our hard-disk but also useful when sending Bamboo Data from one computer to another. The data might still exist on our machine but the other party is not interested in receiving everything. Still the receiver will be able to verify the full integrity of the data. This procedure is called ",(0,i.kt)("strong",{parentName:"p"},"Sparse Replication"),"."),(0,i.kt)("admonition",{title:"Coming up next",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"While we have loads of ideas and draft concepts around ",(0,i.kt)("em",{parentName:"p"},"Sparse Replication")," we haven\u2019t implemented it yet in p2panda. Write us if you are interested in this topic!")),(0,i.kt)("h2",{id:"forks"},"Forks"),(0,i.kt)("p",null,"What happens if we created a log where two Entries contain the same ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink"),"? It would mean that our Log gets split into two branches. This is what we call a ",(0,i.kt)("strong",{parentName:"p"},"Fork"),"."),(0,i.kt)(h,{title:"Forked log",url:a(4103).Z,mdxType:"ImageFrame"}),(0,i.kt)("p",null,"To detect forks, Bamboo introduces the concept of ",(0,i.kt)("strong",{parentName:"p"},"Sequence Numbers"),". Every Entry in the Log gets an unique number, starting at ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," and growing by ",(0,i.kt)("inlineCode",{parentName:"p"},"1")," with each new Entry. We store it in an Entry as the ",(0,i.kt)("inlineCode",{parentName:"p"},"seq_num"),"."),(0,i.kt)("p",null,"This strictly enforced numbering system requires that every Entry is exactly only one step away from the previous one, we can not suddenly jump from Sequence Number ",(0,i.kt)("inlineCode",{parentName:"p"},"2")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"9")," for example."),(0,i.kt)("p",null,"With the help of Sequence Numbers we can detect now forks more easily. We can do this by either detecting: a) duplicate Sequence Numbers b) too large jumps between the Entries Sequence Numbers."),(0,i.kt)(h,{title:"Invalid forked logs",url:a(1587).Z,mdxType:"ImageFrame"}),(0,i.kt)("admonition",{title:"Is it a fork or not?",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"This does not fully prevent us from accidental or malicious forks, we can still imagine scenarios where we will not be able to detect them, for example by hiding the data about the second branch from another person: The fork exists, but they will never see it!")),(0,i.kt)("h2",{id:"tags"},"Tags"),(0,i.kt)("p",null,"We covered it all now. Bamboo entries give us a lot more than postcards: Authentication, Security, Causal Ordering, Deletion, Sparse Replication and Fork Detection!"),(0,i.kt)("p",null,"Now we talked about almost all fields a Bamboo entry contains: ",(0,i.kt)("inlineCode",{parentName:"p"},"author"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"signature"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"seq_num"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"log_id"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"payload_size"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"skiplink"),"."),(0,i.kt)("p",null,"There is one more field we haven\u2019t mentioned yet which is the ",(0,i.kt)("inlineCode",{parentName:"p"},"tag")," field. It can be used to indicate if a Bamboo Log ended. The ",(0,i.kt)("strong",{parentName:"p"},"Tag")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," most of the time, unless when it is indicating the end of the log it is ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),". Authors are not able to create any new Entries to that Log if the Tag is ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),"."),(0,i.kt)("admonition",{title:"Upgrade path",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"This can be used to update Bamboo in the future for example. You can read about this in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AljoschaMeyer/bamboo#encoding"},"specification"),". Since it doesn\u2019t touch upon any p2panda functionality (yet) we did not feature it here.")),(0,i.kt)("h2",{id:"encoding"},"Encoding"),(0,i.kt)("p",null,"Since Bamboo Entries are meant to be used with computers rather than Penguins we need to also specify ",(0,i.kt)("em",{parentName:"p"},"how")," a computer should represent them as bytes. We do this by defining an ",(0,i.kt)("strong",{parentName:"p"},"Encoding"),"."),(0,i.kt)("admonition",{title:"What is an Encoding?",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"An Encoding defines how a computer should interpret sequences of bytes to be able to read and write data of some shape. If we come across the following bits: ",(0,i.kt)("inlineCode",{parentName:"p"},"0110 0011 1010 1001")," we would now need some sort of definition to be able to interpret this? Does this encode a number? An emoji? Or something else?")),(0,i.kt)("p",null,"In the previous sections we already defined that we use Ed25519 for the Digital Signature Algorithm (",(0,i.kt)("inlineCode",{parentName:"p"},"author")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"signature"),") and BLAKE3 hashes wrapped in the YASMF container format (",(0,i.kt)("inlineCode",{parentName:"p"},"payload_hash"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"skiplink"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"backlink"),"), these are not only definitions of algorithms but also concrete encodings of fixed length!"),(0,i.kt)("p",null,"How do we encode ",(0,i.kt)("inlineCode",{parentName:"p"},"log_id")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"seq_num"),"? These are numbers and for them Bamboo uses the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/AljoschaMeyer/varu64"},"VarU64")," encoding."),(0,i.kt)("p",null,"Now we have everything we need to now except of the order of the data, which is:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tag"),", either a zero byte (",(0,i.kt)("inlineCode",{parentName:"li"},"0x00"),") to indicate a regular log entry, or a one byte (",(0,i.kt)("inlineCode",{parentName:"li"},"0x01"),")  to indicate an end-of-log marker"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"author"),", the 32 bytes that make up the ed25519 public key of the log's author"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"log_id"),", the 64 bit integer that serves to distinguish different logs by the same author, encoded as VarU64"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"seq_num"),", the sequence number of the entry, encoded as VarU64"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"skiplink"),", the hash of an older log entry, encoded as yasmf-hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"backlink"),", the hash of the previous log entry, encoded as yasmf-hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"payload_size"),", the size of the payload, encoded as VarU64"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"payload_hash"),", the hash of the payload, encoded as yasmf-hash"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"signature"),", the signature obtained from signing the data with the author's private key (64 bytes)")),(0,i.kt)("p",null,"Let\u2019s look at this binary data here, this ",(0,i.kt)("em",{parentName:"p"},"is")," an Entry! This data is what every computer writes or reads when working with Bamboo:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"10011100110110110011101010001100000011000100101100110000100000010111001111010100110000111100010000111010011001111010011011010000000100110100010001001010111110011001101011001011100010111110011011000101001001000010001101110100011011011001101010100010110000010000000100000001101111000000000000100000011101011001011110101010011010000000101001111111011000011001110101110010111011000100010000010000101110110011101000001010111101001011110010110110011001010000100111100100001111000001110111011110110001110000101111101110111111010100101100010101100011110101110000011010000010000011011010010111010110101000101000100011110110010010111001111111111100111101001000110111010000101101111110110100101001011100010001000111101100101110111101111011100001101111110100010000011000110111010000111011101001101011101101010000111000001101110111001110111111110111110100111000000101001000001001011010101011110011010111001111000111010010001010001000000001100001111111001111111111110000000000110111010110111001000111011100111111000011100011111001010001011010011110011000110100011000000100001010\n")),(0,i.kt)("p",null,"It is a little bit too hard to read, so we convert the binary numbers to hexadecimal ones:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"009cdb3a8c0c4b308173d4c3c43a67a6d013444af99acb8be6c52423746d9aa2c10101bc00207597aa680a7f619d72ec4410bb3a0af4bcb66509e43c1ddec70beefd4b158f5c1a0836975a8a23d92e7ff3d23742dfb4a5c447b2ef7b86fd1063743ba6bb50e0ddceff7d3814825aaf35cf1d2288061fcfff00375b91dcfc38f945a798d1810a\n")),(0,i.kt)("admonition",{title:"Number systems",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Most of the time we are surrounded by decimal numbers like ",(0,i.kt)("inlineCode",{parentName:"p"},"114")," but we can also represent them in different systems, for example binary (",(0,i.kt)("inlineCode",{parentName:"p"},"1110010"),") or hexadecimal (",(0,i.kt)("inlineCode",{parentName:"p"},"72"),"), the latter is used a lot by humans to save some space when looking at data, computers are already very happy with the binary representation.")),(0,i.kt)("p",null,"This is still hard to read but knowing the Bamboo encoding and the length of all items we should be able to take this apart:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# Tag\n00\n\n# Author (ed25519 public key)\n9cdb3a8c0c4b308173d4c3c43a67a6d013444af99acb8be6c52423746d9aa2c1\n\n# Log id\n01 \n\n# Sequence number (it is the first entry in the log!)\n01\n\n# Skiplink and Backlink omitted as it is the first Entry!\n\n# Payload size (188 bytes apparently)\nbc\n\n# Payload hash\n00207597aa680a7f619d72ec4410bb3a0af4bcb66509e43c1ddec70beefd4b158f5c \n\n# Signature\n1a0836975a8a23d92e7ff3d23742dfb4a5c447b2ef7b86fd1063743ba6bb50e0ddceff7d3814825aaf35cf1d2288061fcfff00375b91dcfc38f945a798d1810a\n")),(0,i.kt)("h2",{id:"next-up"},"Next up"),(0,i.kt)("p",null,"The Payload of Entries are ",(0,i.kt)("strong",{parentName:"p"},"Operations")," in p2panda. Operations give more features on top of Bamboo, for example ",(0,i.kt)("em",{parentName:"p"},"Multi-Writer")," updates for collaboration on the same data across Logs and Authors,",(0,i.kt)("em",{parentName:"p"},"Encryption")," and ",(0,i.kt)("em",{parentName:"p"},"Conflict Resistant Data Types")," (CRDTs). Read more about them next."))}y.isMDXComponent=!0},1550:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/comparing-hash-and-size-661dcd20f8a291c59cd57744256b8286.png"},3436:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/entries-chained-by-backlinks-97b147cc321f82a0a025c9f9b4728ef5.png"},4103:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/forked-log-887ef734de79c0da21d9024ffbad0f74.png"},1587:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/invalid-forked-log-44d7c5d1259b1c6b0df1b2133d4f7909.png"},2583:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/log-with-skiplinks-and-deleted-entries-073b4fec0f449d55fbc33658bcb99162.png"},4244:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/multiple-logs-f3775e833dc91875108bd15990dda263.png"},890:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/postcard-from-mr-penguin-9ab074006df4525ceaf2fb9dfd87dd82.png"},7373:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sealing-any-data-43776952b88119230b82a8ba2ad92f78.png"},7687:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/signing-an-entry-with-a-private-key-da9ea651c6c20f69fd59bf348a2b81b8.png"},2e3:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/trying-to-delete-an-entry-458ac12df2db67c9f119d3dcd88bb3ef.png"},2046:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/trying-to-delete-beginning-of-log-2aef590c563347891e7e94b6e9f58f39.png"},255:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/verify-signature-of-entry-f9c13a7677356626e78e5f173f78b9b0.png"}}]);